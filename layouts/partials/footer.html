{{- if not (.Param "hideFooter") }}
<footer class="footer">
    <span>全站文章统计: &nbsp;{{- partial "stat.html" (dict "Kind" "total") }}</span>
    <br>
    
    {{- if site.Copyright }}
    <span>{{ site.Copyright | markdownify }}</span>
    {{- else }}
    <span>&copy; {{ now.Year }} <a href="{{ "" | absLangURL }}">{{ site.Title }}</a></span>
    {{- end }}
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        </div>
    </span>
    <br>
    <!-- busuanzi -->
    <!-- 不判断，直接默认开启 -->
    {{ if .Site.Params.busuanzi.enable -}}
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        <div class="post-meta-icons">
            <svg t="1686157193140" class="icon" viewBox="0 0 1755 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27591" width="14" height="14">
            <path d="M877.824366 1024C336.201509 1024 25.71008 571.977143 12.544366 552.96a73.142857 73.142857 0 0 1 0-81.92C25.71008 452.022857 336.201509 0 877.824366 0s852.114286 452.022857 865.28 471.04a73.142857 73.142857 0 0 1 0 81.92C1729.938651 571.977143 1419.447223 1024 877.824366 1024zM165.412937 512C250.624366 615.131429 504.43008 877.714286 877.824366 877.714286s627.2-262.582857 712.411428-365.714286C1505.024366 408.868571 1251.218651 146.285714 877.824366 146.285714S250.624366 408.868571 165.412937 512z" fill="#8a8a8a" p-id="27592"></path>
            <path d="M877.824366 219.428571a292.571429 292.571429 0 1 0 292.571428 292.571429 292.571429 292.571429 0 0 0-292.571428-292.571429z m-91.794286 292.571429A91.428571 91.428571 0 1 1 877.824366 420.571429a91.428571 91.428571 0 0 1-91.794286 91.428571z" fill="#8a8a8a" p-id="27593"></path>
            </svg>
        </div>
        <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
        <div class="post-meta-icons">
            <svg t="1686156483556" class="icon" viewBox="0 0 1039 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12995" width="14" height="14">
            <path d="M519.68601 528.496009c-144.234503 0-261.649185-117.3757-261.649185-261.649185 0-3.45643-0.103953-8.264247-0.207906-13.838715-0.597729-28.768936-0.766652-52.041368 2.858702-67.946146 13.085058-57.329966 46.194023-105.17424 95.766513-138.374164C402.063422 16.151666 458.50979 0 519.68601 0c59.032193 0 113.76334 14.826267 158.242142 42.880528 48.701884 30.705057 82.473549 75.651646 97.650656 129.940993 5.691416 20.34876 5.99028 51.846456 5.795369 85.072369v8.913952c-0.038982 144.312467-117.453664 261.688167-261.688167 261.688167z m0-445.333773c-44.647725 0-85.085363 11.278878-116.946894 32.628183-31.614644 21.167388-52.691073 51.521604-60.955321 87.762147-1.624262 7.79646-1.052522 35.772756-0.805634 47.740322 0.129941 6.029262 0.233894 11.239896 0.233894 15.592919 0 98.417309 80.06964 178.486949 178.486949 178.486949s178.486949-80.06964 178.486949-178.486949v-9.407728c0.077965-14.046621 0.298864-51.378669-2.715767-62.18976C680.345054 141.063943 626.237625 83.162236 519.68601 83.162236zM1039.359025 1024H0l0.519764-42.100882C2.196003 845.526045 56.953137 732.763251 158.878853 655.812195c46.505882-35.084068 101.938709-62.046824 164.739192-80.043652 60.240645-17.256164 126.211687-25.988199 196.067965-25.988199s135.827321 8.745029 196.067965 25.988199c62.800482 17.996828 118.246304 44.920601 164.739192 80.043652 101.925715 76.951056 156.68285 189.713851 158.359089 326.086923z m-953.052217-83.162236h866.706427c-4.664882-40.424643-15.423996-77.639744-32.147402-111.034579-20.946488-41.879982-51.417651-78.094537-90.52989-107.630125-38.267623-28.924865-84.552605-51.28771-137.490565-66.451824s-111.047573-22.79165-173.159368-22.79165-120.377336 7.666519-173.159368 22.79165-99.222943 37.526959-137.542542 66.451824c-39.112239 29.535588-69.583402 65.750143-90.52989 107.630125-16.723406 33.394835-27.48252 70.609936-32.147402 111.034579z" p-id="12996" fill="#8a8a8a"></path>
            </svg>
        </div>
        <span id="busuanzi_value_site_uv"></span>
    </span>
    </div>
    {{- end -}}

</footer>
{{- end }}

{{- if (not site.Params.disableScrollToTop) }}
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
{{- end }}

{{- partial "extend_footer.html" . }}

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>

{{- if (not site.Params.disableScrollToTop) }}
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
{{- end }}

{{- if (not site.Params.disableThemeToggle) }}
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
{{- end }}

{{- if (and (eq .Kind "page") (ne .Layout "archives") (ne .Layout "search") (.Param "ShowCodeCopyButtons")) }}
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '{{- i18n "code_copy" | default "copy" }}';

        function copyingDone() {
            copybutton.innerHTML = '{{- i18n "code_copied" | default "copied!" }}';
            setTimeout(() => {
                copybutton.innerHTML = '{{- i18n "code_copy" | default "copy" }}';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

{{- end }}
